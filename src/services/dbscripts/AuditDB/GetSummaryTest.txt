-- Function: rt.GetSummary()

-- DROP FUNCTION rt.GetSummary(character varying, integer);

CREATE OR REPLACE FUNCTION rt.GetSummary(IN i_applicationName character varying, IN i_type integer)
  RETURNS TABLE(name character varying, 
		count bigint) AS
$BODY$
BEGIN


BEGIN

IF i_type = 2 THEN
	RETURN QUERY
	select al.Category, count(*) 
	from rt.auditlog al
	where applicationname = i_applicationName
	group by al.Category
	order by al.Category;
ELSE
	RETURN QUERY
	select al.Category, count(*) 
	from rt.auditlog al
	group by al.Category
	order by al.Category;
END IF;

END;
END
$BODY$
  LANGUAGE plpgsql VOLATILE
  COST 100;
ALTER FUNCTION rt.GetSummary()
  OWNER TO postgres;

/*  
select rt.GetSummary('RisingTide', 1)
select rt.GetSummary('RisingTide', 2)

*/
